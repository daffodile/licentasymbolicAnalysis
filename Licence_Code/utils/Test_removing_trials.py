import os

from input_reader.InitDataSetWithBurstsFlags import InitDataSetWithBurstsFlags
from utils.MarkOutsiderWithBurstFlags_SeparateThresholds import mark_bursts_regions
from utils.MarkOutsidersWithBurstsFlags import remove_bursted_trials_when_segment

data_dir = os.path.join('', '..')
initialization = InitDataSetWithBurstsFlags(data_dir, levels=['deep', 'medium', 'light'])
doas = initialization.get_dataset_as_doas()

print('do not expand left right')
#
# thresholds = {2: 23.263285, 3: 22.366724, 4: 27.422037, 5: 22.331213, 6: 23.394754, 7: 22.354338, 8: 27.749441,
#               9: 29.266874, 10: 22.621815, 11: 22.75086, 12: 22.371376, 13: 21.829714, 14: 27.50188, 15: 23.687954,
#               16: 29.949093, 17: 25.198391, 18: 32.699684, 19: 25.501558, 20: 21.380661, 21: 25.648182, 23: 25.984198,
#               24: 26.205786, 25: 25.768787, 26: 20.381828, 27: 25.502258, 28: 20.292067, 29: 25.598713, 30: 27.259365,
#               31: 25.049229, 32: 30.300776}

thresholds_2 = {'2': [-29.16208267211914, 29.830608367919922], '3': [-28.065452575683594, 28.921966552734375],
                '4': [-34.38615417480469, 35.25702667236328], '5': [-28.023412704467773, 28.899110794067383],
                '6': [-29.32749366760254, 30.000972747802734], '7': [-28.051198959350586, 28.920198440551758],
                '8': [-34.79737091064453, 35.684852600097656], '9': [-36.712547302246094, 37.74555969238281],
                '10': [-28.37700843811035, 29.177644729614258], '11': [-28.5379695892334, 29.334697723388672],
                '12': [-28.06175422668457, 28.84296226501465], '13': [-27.38531494140625, 28.172622680664062],
                '14': [-34.50564956665039, 35.53166580200195], '15': [-29.73434829711914, 30.73203468322754],
                '16': [-37.593997955322266, 38.8660888671875], '17': [-31.5568790435791, 32.030128479003906],
                '18': [-40.99643325805664, 41.98263168334961], '19': [-31.922082901000977, 32.28758239746094],
                '20': [-26.776390075683594, 26.731401443481445], '21': [-32.09612274169922, 32.387062072753906],
                '23': [-32.520633697509766, 32.84562683105469], '24': [-32.79780197143555, 33.1236572265625],
                '25': [-32.26771926879883, 32.728233337402344], '26': [-25.530717849731445, 25.960113525390625],
                '27': [-31.93470573425293, 32.3910026550293], '28': [-25.4182186126709, 25.843904495239258],
                '29': [-32.056251525878906, 32.51969909667969], '30': [-34.16683578491211, 34.915077209472656],
                '31': [-31.370412826538086, 31.845157623291016], '32': [-37.98116683959961, 38.829158782958984]}

mark_bursts_regions(doas, thresholds=thresholds_2)
# mark_bursts_regions(doas)
remove_bursted_trials_when_segment(doas, tolerance_inside_trial=0.5)

'''
run with threshold/ channel that are converged 0.33 tolerance
~ 140 deep, 78 medium, 27 light

same converged trials, tolerance 0.5
deep 206, medium 140, light 73

first threshold met per channel tolerance 0.33
deep 181, medium 123, light 80

first thresold met per channel, tolerance 0.5
deep 216, medium 191, light 147
'''
